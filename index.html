<!DOCTYPE html>
<html lang="si">
<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

   <!-- <title>Firebase Monitoring Dashboard</title> !-->

    <link rel="stylesheet" href="style.css">         <!-- CSS Link Karanna !-->

 

</head>

<body>
    <div class="container">

       
        
        <div id="data-container">
            <p>Loading data...</p>
        </div>
        
        <button class="refresh-btn" onclick="fetchData()">Refresh Data</button>


       

        <div class="Tank_1_Config">
           
            <div class="Tank_01" id="Tank_01"></div>

          </div>


          <div class="Tank_2_Config">
           
            <div class="Tank_02" id="Tank_02"></div>

          </div> 
          
          <div class="Tank_3_Config">
           
            <div class="Tank_03" id="Tank_03"></div>

          </div> 

          
      




        <div id="last-updated" class="timestamp">Last updated: Loading...</div>
            
         
        <h3 id="Pump_House_Device">ERR_PH_DEAVIC : Loading...</h3>


        
        <div class="motor-card">
            <div class="motor-header">
              <i class="fas fa-cogs"></i>
              <h2>Motor 01</h2>
            </div>
            <div class="motor-status">
              <h3 id="Motor_01_I1">Last updated: Loading...</h3>
              <h3 id="Motor_01_I2">RPM: Loading...</h3>
              <h3 id="Motor_01_I3">Voltage: Loading...</h3>
              <h3 id="Motor_01_I4">Temperature: Loading...</h3>
              <h3 id="Motor_01_I5">Last Updated: Loading...</h3>
            </div>
          </div>


    </div>



    
    <script>

        // üîê Firebase database ‡∂ë‡∂ö connect ‡∂ö‡∂ª‡∂±‡∑ä‡∂± ‡∂Ö‡∑Ä‡∑Å‡∑ä‚Äç‡∂∫ configuration
        const FIREBASE_HOST = "https://uditha-2fc62-default-rtdb.asia-southeast1.firebasedatabase.app";
        const FIREBASE_AUTH = "0PfE9nU0OvR4CnRhVWMaQPFnSupj63CIGggX6bKU";

        
        let PH_COM_0_Count = 0; // PH_COM_1_Count counter ‡∂ë‡∂ö
        let PH_COM_1_Count = 0; // PH_COM_0_Count counter ‡∂ë‡∂ö

        
        // üì• Firebase database ‡∂ë‡∂ö‡∑ô‡∂±‡∑ä data ‡∂Ω‡∂∂‡∑è‡∂ú‡∂±‡∑ä‡∂± asynchronous function ‡∂ë‡∂ö
        async function fetchData() {
            try {
                // üåê Firebase ‡∂ë‡∂ö‡∂ß GET request ‡∂ë‡∂ö‡∂ö‡∑ä ‡∂∫‡∑Ä‡∂±‡∑Ä‡∑è
                const response = await fetch(`${FIREBASE_HOST}/.json?auth=${FIREBASE_AUTH}`);
                
                // üîÑ Response ‡∂ë‡∂ö JSON object ‡∂ë‡∂ö‡∂ö‡∑ä ‡∂∂‡∑Ä‡∂ß convert ‡∂ö‡∂ª‡∂±‡∑Ä‡∑è
                const data = await response.json();
                
                // ‚úÖ Data ‡∂ë‡∂ö valid ‡∂±‡∂∏‡∑ä displayData() function ‡∂ë‡∂ö‡∂ß ‡∂∫‡∑Ä‡∂±‡∑Ä‡∑è
                if (data) {
                    displayData(data);
                    
                    // üïí ‡∂Ø‡∑ê‡∂±‡∑ä ‡∑Ä‡∑ô‡∂Ω‡∑è‡∑Ä ‡∂ú‡∂±‡∑ä‡∂±‡∑Ä‡∑è
                    const now = new Date();
    
                    // üìå UI ‡∂ë‡∂ö‡∑ö 'last-updated' ‡∂ö‡∑í‡∂∫‡∂± element ‡∂ë‡∂ö update ‡∂ö‡∂ª‡∂±‡∑Ä‡∑è
                    document.getElementById('last-updated').textContent = 
                        `Last updated: ${now.toLocaleTimeString()}`;
                }
            } catch (error) {
                // ‚ùå Data ‡∂ú‡∂±‡∑ä‡∂± ‡∂ú‡∑í‡∂∫‡∑ö ‡∂±‡∑ë‡∂±‡∂∏‡∑ä error ‡∂ë‡∂ö console ‡∂ë‡∂ö‡∂ß print ‡∂ö‡∂ª‡∂±‡∑Ä‡∑è
                console.error('Error fetching data:', error);
    

                // ‚ö†Ô∏è UI ‡∂ë‡∂ö‡∂ß error message ‡∂ë‡∂ö‡∂ö‡∑ä ‡∂Ø‡∑è‡∂±‡∑Ä‡∑è
                document.getElementById('data-container').innerHTML = 
                    '<p>Error loading data. Please try again.</p>';
            }
        }
        


        // üñ•Ô∏è Data ‡∂ë‡∂ö UI ‡∂ë‡∂ö‡∑ö ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∂±‡∑ä‡∂± function ‡∂ë‡∂ö
        function displayData(data) {
            // üì¶ Data ‡∂ë‡∂ö ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∂±‡∑ä‡∂± ‡∂≠‡∑í‡∂∫‡∂± container ‡∂ë‡∂ö select ‡∂ö‡∂ª‡∂±‡∑Ä‡∑è
            const container = document.getElementById('data-container');
    
            // üßπ ‡∂¥‡∑ê‡∂ª‡∂´‡∑í content clear ‡∂ö‡∂ª‡∂±‡∑Ä‡∑è
           container.innerHTML = '';

      
            // üß© Panal 1-4 ‡∂Ø‡∂ö‡∑ä‡∑Ä‡∑è ‡∂≠‡∑í‡∂∫‡∂± value ‡∂ë‡∂ö‡∂ö‡∑ä display ‡∂ö‡∂ª‡∂±‡∑ä‡∂± createDataItem() function ‡∂ë‡∂ö call ‡∂ö‡∂ª‡∂±‡∑Ä‡∑è
            createDataItem(container, "Panal_1", data['Panal_1']);
            createDataItem(container, "Panal_2", data['Panal_2']);
            createDataItem(container, "Panal_3", data['Panal_3']);
            createDataItem(container, "Panal_4", data['Panal_4']);
            createDataItem(container, "WL", data['WL']);
            createDataItem(container, "PH_Com", data['PH_Com']);

        }
        
        // üèóÔ∏è data item ‡∂ë‡∂ö‡∂ö‡∑ä UI ‡∂ë‡∂ö‡∂ß ‡∑Ñ‡∂Ø‡∂± helper function ‡∂ë‡∂ö
        function createDataItem(container, key, value) {
            // üî≤ ‡∂±‡∑Ä data item ‡∂ë‡∂ö‡∂ö‡∑ä represent ‡∂ö‡∂ª‡∂± div ‡∂ë‡∂ö‡∂ö‡∑ä ‡∑Ñ‡∂Ø‡∂±‡∑Ä‡∑è
            const itemDiv = document.createElement('div');
            itemDiv.className = 'data-item';

           
              // Panal_1 key ‡∂ë‡∂ö‡∂ß ‡∂∂‡∂Ω‡∂±‡∑Ä‡∑è Edit By uditha Asiri

           if (key === "Panal_1" && String(value).charAt(0) === '1') {  ///////////////// Motor 01 Runing...

            // value function call ‡∂ë‡∂ö ‡∑Ñ‡∂ª‡∑í‡∂∫‡∂ß use ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
                 document.getElementById('Motor_01_I1').textContent = 
                `Motor 01 : ${" Runing..."}`;  // value() ‡∂ë‡∂ö‡∂ß function call ‡∂±‡∑ú‡∂ö‡∂ª‡∂±‡∑Ä‡∑è

               

            }

            if (key === "Panal_1" && String(value).charAt(0) === '2') { ///////////////// Motor 01 Stop

            // value function call ‡∂ë‡∂ö ‡∑Ñ‡∂ª‡∑í‡∂∫‡∂ß use ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
                document.getElementById('Motor_01_I1').textContent = 
                `Motor 01 : ${" STOP"}`;  // value() ‡∂ë‡∂ö‡∂ß function call ‡∂±‡∑ú‡∂ö‡∂ª‡∂±‡∑Ä‡∑è
              

            }

        
            if (key === "Panal_1" && String(value).charAt(1) === '1') {  ///////////////// Motor 01 Auto / Manual
            // value function call ‡∂ë‡∂ö ‡∑Ñ‡∂ª‡∑í‡∂∫‡∂ß use ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
                   document.getElementById('Motor_01_I2').textContent = 
                  `Motor 01 : ${" Auto"}`;  // value() ‡∂ë‡∂ö‡∂ß function call ‡∂±‡∑ú‡∂ö‡∂ª‡∂±‡∑Ä‡∑è
               
            }

            if (key === "Panal_1" && String(value).charAt(1) === '2') { ///////////////// Motor 01 Manual

                // value function call ‡∂ë‡∂ö ‡∑Ñ‡∂ª‡∑í‡∂∫‡∂ß use ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
                      document.getElementById('Motor_01_I2').textContent = 
                     `Motor 01 : ${" Manual"}`;  // value() ‡∂ë‡∂ö‡∂ß function call ‡∂±‡∑ú‡∂ö‡∂ª‡∂±‡∑Ä‡∑è
                     
            }



            if (key === "WL") { ////////////////////////////////////// TANK 1 LEVEL Send html code

               if(String(value).charAt(0) === '1') {
                         
                document.getElementById("Tank_01").style.height = "0%"; // Tank eka fill wenawa        

               }

               if(String(value).charAt(0) === '2') {
                         
                document.getElementById("Tank_01").style.height = "33%"; // Tank eka fill wenawa        

               }

               if(String(value).charAt(0) === '3') {
                         
                document.getElementById("Tank_01").style.height = "66%"; // Tank eka fill wenawa
                
               }

               if(String(value).charAt(0) === '4') {
                         
                document.getElementById("Tank_01").style.height = "100%"; // Tank eka fill wenawa
                         
               }
                    
  
             }/////////////////////////////// Tank 1 end


             if (key === "WL") { ////////////////////////////////////// TANK 2 LEVEL Send html code

                if(String(value).charAt(1) === '1') {
          
                    document.getElementById("Tank_02").style.height = "0%"; // Tank eka fill wenawa        

                }

                if(String(value).charAt(1) === '2') {
          
                    document.getElementById("Tank_02").style.height = "33%"; // Tank eka fill wenawa        

                }

                if(String(value).charAt(1) === '3') {
          
                     document.getElementById("Tank_02").style.height = "66%"; // Tank eka fill wenawa
 
                }

                if(String(value).charAt(1) === '4') {
          
                    document.getElementById("Tank_02").style.height = "100%"; // Tank eka fill wenawa
          
                }
     

           }/////////////////////////////// Tank 2 end
          

           if (key === "WL") { ////////////////////////////////////// TANK 3 LEVEL Send html code

               if(String(value).charAt(2) === '1') {

                 document.getElementById("Tank_03").style.height = "0%"; // Tank eka fill wenawa        

            }

            if(String(value).charAt(2) === '2') {

                 document.getElementById("Tank_03").style.height = "33%"; // Tank eka fill wenawa        

            }               

            if(String(value).charAt(2) === '3') {

                 document.getElementById("Tank_03").style.height = "66%"; // Tank eka fill wenawa

            }

            if(String(value).charAt(2) === '4') {

                document.getElementById("Tank_03").style.height = "100%"; // Tank eka fill wenawa

            }


        }/////////////////////////////// Tank 3 end





        
        ////////////////////////////////////////////////////////////////////////////////////////// PH And Tank Comm Check
        ////////////////////////////////////////////////////////////////////////////////////////// PH And Tank Comm Check


            if (key === "PH_Com" && String(value).charAt(0) === '0') {

                PH_COM_0_Count++;
                PH_COM_1_Count = 0;
 
                 document.getElementById('Motor_01_I3').textContent = 
                `Motor 01 : ${PH_COM_0_Count}`;  // value() ‡∂ë‡∂ö‡∂ß function call ‡∂±‡∑ú‡∂ö‡∂ª‡∂±‡∑Ä‡∑è

            }


            if (key === "PH_Com" && String(value).charAt(0) === '1') {

                PH_COM_1_Count++;
                PH_COM_0_Count = 0;

                 document.getElementById('Motor_01_I4').textContent = 
                `Motor 01 : ${PH_COM_1_Count}`;  // value() ‡∂ë‡∂ö‡∂ß function call ‡∂±‡∑ú‡∂ö‡∂ª‡∂±‡∑Ä‡∑è

            }

            if(PH_COM_0_Count < 10 && PH_COM_1_Count < 10 ){

                document.getElementById('Pump_House_Device').textContent = 
                `Pump House Device : ${" Online"}`;  // value() ‡∂ë‡∂ö‡∂ß function call ‡∂±‡∑ú‡∂ö‡∂ª‡∂±‡∑Ä‡∑è
             
            }else{
                
                document.getElementById('Pump_House_Device').textContent = 
                `Pump House Device : ${" Offline"}`;  // value() ‡∂ë‡∂ö‡∂ß function call ‡∂±‡∑ú‡∂ö‡∂ª‡∂±‡∑Ä‡∑è

            }


               // ERR_PH_DEAVIC
        

        ////////////////////////////////////////////////////////////////////////////////////////// PH And Tank Comm Check End
        ////////////////////////////////////////////////////////////////////////////////////////// PH And Tank Comm Check End




        }


        
        // üü¢ Page ‡∂ë‡∂ö fully load ‡∑Ä‡∑î‡∂´‡∑î ‡∂¥‡∑É‡∑î ‡∂¥‡∑Ö‡∂∏‡∑î‡∑Ä data fetch ‡∂ö‡∂ª‡∂±‡∑Ä‡∑è
        document.addEventListener('DOMContentLoaded', fetchData);
        
        // üîÅ ‡∑Ñ‡∑ê‡∂∏ milliseconds 500‡∂ö interval ‡∂ë‡∂ö‡∂ö‡∑í‡∂±‡∑ä data ‡∂ë‡∂ö ‡∂±‡∑ê‡∑Ä‡∂≠ fetch ‡∂ö‡∂ª‡∂±‡∑Ä‡∑è
        setInterval(fetchData, 500);
    
    </script>
    
</body>
</html>